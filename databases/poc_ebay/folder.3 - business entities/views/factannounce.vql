CREATE OR REPLACE VIEW factannounce FOLDER = '/3 - business entities'
    PRIMARY KEY ( 'announce_key' ) (
    hours_before_first_crawling (sourcetypesize = '19', sourcetypeid = '-5')
)
 AS SELECT rownum() AS announce_key, vehicle.vehicle_key AS vehicle_key, offer.offer_key AS offer_key, announcer.announcer_key AS announcer_key, dates.dates_key AS dates_key, lieux.postalcode AS postalcode, iv_join_codes_postaux_autos.price_decimal AS price_decimal, getdaysbetween(iv_join_codes_postaux_autos.datecreated, iv_join_codes_postaux_autos.datecrawled) AS days_before_first_crawling, case WHEN (getdaysbetween(iv_join_codes_postaux_autos.datecreated, iv_join_codes_postaux_autos.datecrawled) = 0) THEN (gethour(iv_join_codes_postaux_autos.datecrawled)-gethour(iv_join_codes_postaux_autos.datecreated)) END AS hours_before_first_crawling, (iv_join_codes_postaux_autos.powerps_nb*0.73549875) AS vehicle_energy_kwh FROM ((((iv_04_join_codes_postaux_autos AS iv_join_codes_postaux_autos INNER JOIN offer AS offer ON (iv_join_codes_postaux_autos.name = offer.name AND iv_join_codes_postaux_autos.offertype_eng = offer.offertype_eng AND iv_join_codes_postaux_autos.nrofpictures = offer.nrofpictures AND iv_join_codes_postaux_autos.abtest = offer.abtest) ) INNER JOIN vehicle AS vehicle ON (iv_join_codes_postaux_autos.vehicletype = vehicle.vehicletype AND iv_join_codes_postaux_autos.model = vehicle.model AND iv_join_codes_postaux_autos.brand = vehicle.brand AND iv_join_codes_postaux_autos.fueltype = vehicle.fueltype AND iv_join_codes_postaux_autos.gearbox_eng = vehicle.gearbox_eng AND iv_join_codes_postaux_autos.powerps_nb = vehicle.powerps_nb AND iv_join_codes_postaux_autos.yearofregistration = vehicle.yearofregistration AND iv_join_codes_postaux_autos.monthofregistration = vehicle.monthofregistration AND iv_join_codes_postaux_autos.kilometer = vehicle.kilometer AND iv_join_codes_postaux_autos.notrepaireddamage_eng = vehicle.notrepaireddamage_eng) ) INNER JOIN announcer AS announcer ON iv_join_codes_postaux_autos.seller_eng = announcer.seller_eng ) INNER JOIN lieux AS lieux ON iv_join_codes_postaux_autos.postalcode = lieux.postalcode ) INNER JOIN dates AS dates ON (iv_join_codes_postaux_autos.datecrawled = dates.datecrawled AND iv_join_codes_postaux_autos.datecreated = dates.datecreated AND iv_join_codes_postaux_autos.lastseenonline = dates.lastseenonline) ;

ALTER VIEW factannounce
 LAYOUT (iv_04_join_codes_postaux_autos = [360, 210, 200, 200], offer = [740, 120, 200, 125], vehicle = [70, 40, 200, 245], announcer = [360, 100, 200, 65], lieux = [70, 340, 200, 165], dates = [740, 330, 200, 105]);

